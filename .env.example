# Database
DATABASE_URL=postgresql://aiemailuser:aiemailpass@localhost:5434/aiemaildb

# Frontend URL
FRONTEND_URL=http://localhost:3001

# Backend API URL (for server-to-server and frontend API calls)
BACKEND_URL=http://localhost:3002

# Express server port
PORT=3002

# Auth secret
BETTER_AUTH_SECRET=your-secret-key-here

# Encryption key (generate with: openssl rand -base64 32)
ENCRYPTION_KEY=your-encryption-key-here

# Google OAuth Configuration
# Create credentials at: https://console.cloud.google.com/apis/credentials
# Redirect URI: http://localhost:3002/api/auth/callback/google
GOOGLE_CLIENT_ID=your-google-client-id-here
GOOGLE_CLIENT_SECRET=your-google-client-secret-here

# OAuth Redirect URIs (for email account OAuth flow)
OAUTH_REDIRECT_URI=http://localhost:3002/api/oauth-direct/callback
OAUTH_COMPLETE_REDIRECT_URI=http://localhost:3001/settings/email-accounts/oauth-complete
OAUTH_ERROR_REDIRECT_URI=http://localhost:3001/settings/email-accounts
OAUTH_CALLBACK_URI=http://localhost:3001/settings/email-accounts/oauth-callback

# Trusted CORS Origins (comma-separated list)
TRUSTED_ORIGINS=http://localhost:3001,http://localhost:3002

# Next.js Public Environment Variables (exposed to browser)
NEXT_PUBLIC_API_URL=http://localhost:3002

# Environment
NODE_ENV=development

# Redis Configuration
REDIS_URL=redis://localhost:6380

# Email Processing Pipeline Configuration
EMAIL_PIPELINE_CONCURRENCY=1

# Vector Search Configuration (PostgreSQL + In-Memory)
# System now uses PostgreSQL storage + Vectra in-memory search
# No external vector database required - Qdrant has been removed

# Vector Search Settings
# Minimum similarity score threshold for vector search (0-1, default: 0.5)
# Filters out low-quality matches below this cosine similarity threshold
VECTOR_SCORE_THRESHOLD=0.5
# Number of examples to use for draft generation (default: 10)
EXAMPLE_COUNT=10
# Maximum percentage of examples from direct correspondence (default: 0.6 = 60%)
DIRECT_EMAIL_MAX_PERCENTAGE=0.6

# Vector Performance Settings
# Batch size for embedding generation (default: 32)
EMBEDDING_BATCH_SIZE=32
# Maximum number of candidate emails to fetch from database for vector search (default: 100)
# Lower values improve performance but may reduce match quality
VECTOR_FETCH_LIMIT=100
# Maximum number of direct email candidates to fetch during example selection (default: 10)
DIRECT_EMAIL_FETCH_LIMIT=10
# Maximum number of relationship category candidates to fetch during example selection (default: 30)
CATEGORY_EMAIL_FETCH_LIMIT=30

# Temporal Weighting Configuration
# Weights for temporal decay based on email age (recent emails prioritized)
# Weight for emails 0-3 months old (default: 1.0)
TEMPORAL_WEIGHT_0_3M=1.0
# Weight for emails 3-6 months old (default: 0.85)
TEMPORAL_WEIGHT_3_6M=0.85
# Weight for emails 6-12 months old (default: 0.7)
TEMPORAL_WEIGHT_6_12M=0.7
# Weight for emails 12+ months old (default: 0.5)
TEMPORAL_WEIGHT_12M_PLUS=0.5

# Dual Embedding Configuration (semantic + style vectors)
# Weight for semantic (topic) similarity (0-1, default: 0.4 = 40%)
# Semantic embeddings capture content/topic similarity
SEMANTIC_WEIGHT=0.4
# Weight for style (tone) similarity (0-1, default: 0.6 = 60%)
# Style embeddings capture writing tone, formality, and patterns
STYLE_WEIGHT=0.6

# Pipeline Configuration
# Batch size for processing emails in parallel (default: 100)
PIPELINE_BATCH_SIZE=100
# Number of parallel workers for email processing (default: 5)
PIPELINE_PARALLELISM=5
# Number of retry attempts for failed operations (default: 3)
PIPELINE_RETRY_ATTEMPTS=3
# Maximum error rate before stopping (0-1, default: 0.1 = 10%)
PIPELINE_ERROR_THRESHOLD=0.1
# Number of examples to use for tone learning (default: 10, optimized for few-shot learning)
EXAMPLE_COUNT=10
# Maximum percentage of examples from direct emails with recipient (0-1, default: 0.6 = 60%)
# With 10 examples: 6 from direct correspondence, 4 from relationship category
DIRECT_EMAIL_MAX_PERCENTAGE=0.6

# Writing Pattern Analysis Configuration
# Number of emails to analyze for pattern extraction (default: 200)
PATTERN_ANALYSIS_CORPUS_SIZE=200
# Maximum tokens for pattern analysis LLM calls (default: 20000)
PATTERN_ANALYSIS_MAX_TOKENS=20000
# Number of example sentences to keep (default: 10)
PATTERN_EXAMPLE_COUNT=10
# Number of unique expressions to track (default: 15)
PATTERN_UNIQUE_EXPRESSIONS_COUNT=15

# Style Aggregation Configuration
# Maximum number of historical emails to analyze for style aggregation (default: 1000)
# Balances between comprehensive analysis and query performance
STYLE_MAX_EMAILS_TO_ANALYZE=1000
# Estimated average sentence length in words for complexity scoring (default: 15)
# Used as baseline when actual sentence parsing is not performed
STYLE_ESTIMATED_SENTENCE_LENGTH=15
# Word count threshold to determine multi-paragraph style (default: 200)
# Emails longer than this are likely to use multiple paragraphs
STYLE_MULTI_PARAGRAPH_THRESHOLD=200
# Formality score thresholds for converting numeric scores to descriptors (0-1 scale)
# Very formal threshold (default: 0.8)
STYLE_FORMALITY_VERY_FORMAL=0.8
# Formal threshold (default: 0.6)
STYLE_FORMALITY_FORMAL=0.6
# Neutral threshold (default: 0.4)
STYLE_FORMALITY_NEUTRAL=0.4
# Casual threshold (default: 0.2)
STYLE_FORMALITY_CASUAL=0.2
# Confidence score thresholds based on sample size (number of emails analyzed)
# Minimum sample size for low confidence (default: 10)
STYLE_CONFIDENCE_MIN_SAMPLE=10
# Sample size for low-to-medium confidence (default: 50)
STYLE_CONFIDENCE_LOW=50
# Sample size for medium-to-high confidence (default: 100)
STYLE_CONFIDENCE_MEDIUM=100
# Sample size for high confidence (default: 500)
STYLE_CONFIDENCE_HIGH=500
# Phrase frequency thresholds for style pattern detection (percentage 0-100)
# Minimum percentage for a phrase to be considered "preferred" (default: 20)
STYLE_PREFERRED_PHRASE_THRESHOLD=20
# Minimum percentage for a phrase to be included in prompt templates (default: 30)
STYLE_PROMPT_PHRASE_THRESHOLD=30

# Relationship-Based Style Thresholds
# Formality buffer for vector search range (default: 0.2)
# Used to widen search by Â±0.2 around user's formality score
RELATIONSHIP_FORMALITY_BUFFER=0.2
# Email length categorization thresholds (in words)
# Very brief threshold (default: 50)
RELATIONSHIP_EMAIL_VERY_BRIEF=50
# Brief threshold (default: 100)
RELATIONSHIP_EMAIL_BRIEF=100
# Detailed threshold (default: 200)
RELATIONSHIP_EMAIL_DETAILED=200
# Formality level thresholds for prompt formatting (0-1 scale)
# Casual threshold (default: 0.3)
RELATIONSHIP_FORMALITY_CASUAL=0.3
# Moderate threshold (default: 0.7)
RELATIONSHIP_FORMALITY_MODERATE=0.7
# Enthusiasm level thresholds for prompt formatting (0-1 scale)
# Low enthusiasm threshold (default: 0.4)
RELATIONSHIP_ENTHUSIASM_LOW=0.4
# High enthusiasm threshold (default: 0.7)
RELATIONSHIP_ENTHUSIASM_HIGH=0.7
# Brevity level thresholds for prompt formatting (0-1 scale)
# Low brevity threshold (default: 0.4)
RELATIONSHIP_BREVITY_LOW=0.4
# High brevity threshold (default: 0.7)
RELATIONSHIP_BREVITY_HIGH=0.7
# Minimum frequency for phrases/emojis to be considered significant (default: 2)
RELATIONSHIP_MIN_PHRASE_FREQUENCY=2

# LLM Configuration
# Number of retry attempts for LLM action analysis and response generation (default: 1)
LLM_ACTION_RETRIES=1

# Email Folder Configuration
# Default folder names for email organization
# Root folder for all email folders (leave empty for root level)
DEFAULT_ROOT_FOLDER=
# Folder for no-action emails (FYI only, large lists, unsubscribe)
DEFAULT_NO_ACTION_FOLDER=t2j-no-action
# Folder for spam emails
DEFAULT_SPAM_FOLDER=t2j-spam
# Folder for action items that need attention
DEFAULT_TODO_FOLDER=t2j-todo

# Background Job Scheduler Configuration
# Interval for checking new emails in milliseconds (default: 60000 = 1 minute)
CHECK_MAIL_INTERVAL=60000
# Interval for updating tone profiles in milliseconds (default: 86400000 = 24 hours)
UPDATE_TONE_INTERVAL=86400000

# Worker configuration (optional)
WORKERS_START_PAUSED=false  # Set to false to start workers automatically (true for manual control)
NEXT_PUBLIC_INBOX_BATCH_SIZE=3  # Number of emails to process in each batch (used by both server and client)
NEXT_PUBLIC_LOOK_BACK_DEFAULT_MINUTES=15  # Default time window for look back processing in minutes (used by both server and client)

# Email Processing Lock Configuration (distributed locking to prevent duplicate drafts)
EMAIL_PROCESSING_LOCK_TTL=90000  # Lock timeout in milliseconds (default: 90000 = 90 seconds, must exceed max batch processing time)
EMAIL_PROCESSING_LLM_TIMEOUT=40000  # LLM generation timeout in milliseconds (default: 40000 = 40 seconds)

# BullMQ Worker Configuration
# Inbox worker settings
BULLMQ_INBOX_CONCURRENCY=5  # Number of concurrent jobs (default: 5)
BULLMQ_INBOX_LOCK_DURATION=120000  # Max job duration in ms (default: 120000 = 2 minutes)
BULLMQ_INBOX_LOCK_RENEW_TIME=30000  # Lock renewal interval in ms (default: 30000 = 30 seconds)
BULLMQ_INBOX_STALLED_INTERVAL=30000  # Stalled job check interval in ms (default: 30000 = 30 seconds)
BULLMQ_INBOX_MAX_STALLED_COUNT=1  # Max stall count before job fails (default: 1)

# Training worker settings
BULLMQ_TRAINING_CONCURRENCY=2  # Number of concurrent jobs (default: 2)
BULLMQ_TRAINING_LOCK_DURATION=600000  # Max job duration in ms (default: 600000 = 10 minutes)
BULLMQ_TRAINING_LOCK_RENEW_TIME=60000  # Lock renewal interval in ms (default: 60000 = 1 minute)
BULLMQ_TRAINING_STALLED_INTERVAL=60000  # Stalled job check interval in ms (default: 60000 = 1 minute)
BULLMQ_TRAINING_MAX_STALLED_COUNT=1  # Max stall count before job fails (default: 1)

# BullMQ Redis connection settings
BULLMQ_REDIS_RETRY_DELAY_MIN=50  # Min retry delay in ms (default: 50)
BULLMQ_REDIS_RETRY_DELAY_MAX=2000  # Max retry delay in ms (default: 2000)

# BullMQ Runtime cleanup settings
BULLMQ_CLEANUP_INTERVAL=120000  # Periodic cleanup interval in ms (default: 120000 = 2 minutes)
BULLMQ_INBOX_CLEANUP_STALE_AGE=180000  # Age threshold for stale inbox jobs in ms (default: 180000 = 3 minutes, inbox lock + 1 min buffer)
BULLMQ_TRAINING_CLEANUP_STALE_AGE=660000  # Age threshold for stale training jobs in ms (default: 660000 = 11 minutes, training lock + 1 min buffer)