# Database
DATABASE_URL=postgresql://aiemailuser:aiemailpass@localhost:5434/aiemaildb

# Frontend URL
FRONTEND_URL=http://localhost:3001

# Backend API URL (for server-to-server and frontend API calls)
BACKEND_URL=http://localhost:3002

# Express server port
PORT=3002

# Auth secret
BETTER_AUTH_SECRET=your-secret-key-here

# Encryption key (generate with: openssl rand -base64 32)
ENCRYPTION_KEY=your-encryption-key-here

# Google OAuth Configuration
# Create credentials at: https://console.cloud.google.com/apis/credentials
# Redirect URI: http://localhost:3002/api/auth/callback/google
GOOGLE_CLIENT_ID=your-google-client-id-here
GOOGLE_CLIENT_SECRET=your-google-client-secret-here

# OAuth Redirect URIs (for email account OAuth flow)
OAUTH_REDIRECT_URI=http://localhost:3002/api/oauth-direct/callback
OAUTH_COMPLETE_REDIRECT_URI=http://localhost:3001/settings/email-accounts/oauth-complete
OAUTH_ERROR_REDIRECT_URI=http://localhost:3001/settings/email-accounts
OAUTH_CALLBACK_URI=http://localhost:3001/settings/email-accounts/oauth-callback

# Trusted CORS Origins (comma-separated list)
TRUSTED_ORIGINS=http://localhost:3001,http://localhost:3002

# Next.js Public Environment Variables (exposed to browser)
NEXT_PUBLIC_API_URL=http://localhost:3002

# Environment
NODE_ENV=development

# Redis Configuration
REDIS_URL=redis://localhost:6380

# Email Processing Pipeline Configuration
EMAIL_PIPELINE_CONCURRENCY=1

# Qdrant Vector Database Configuration
# URL for Qdrant vector database (default: http://localhost:6333)
QDRANT_URL=http://localhost:6333
# Optional API key for Qdrant (leave empty for local development)
QDRANT_API_KEY=

# Vector Search Settings
# Maximum number of results to return from vector search (default: 50)
VECTOR_SEARCH_LIMIT=50
# Minimum similarity score threshold for vector search (0-1, default: 0)
# Set to 0 to get all results sorted by similarity without filtering
VECTOR_SCORE_THRESHOLD=0
# Similarity threshold for near-duplicate detection (0-1, default: 0.98)
NEAR_DUPLICATE_THRESHOLD=0.98
# Minimum number of examples required per relationship type (default: 10)
MIN_EXAMPLES_PER_RELATIONSHIP=10

# Vector Performance Settings
# Batch size for embedding generation (default: 32)
EMBEDDING_BATCH_SIZE=32
# Timeout for vector search operations in milliseconds (default: 5000)
VECTOR_SEARCH_TIMEOUT_MS=5000

# Pipeline Configuration
# Batch size for processing emails in parallel (default: 100)
PIPELINE_BATCH_SIZE=100
# Number of parallel workers for email processing (default: 5)
PIPELINE_PARALLELISM=5
# Number of retry attempts for failed operations (default: 3)
PIPELINE_RETRY_ATTEMPTS=3
# Maximum error rate before stopping (0-1, default: 0.1 = 10%)
PIPELINE_ERROR_THRESHOLD=0.1
# Number of examples to use for tone learning (default: 25)
EXAMPLE_COUNT=25
# Maximum percentage of examples from direct emails with recipient (0-1, default: 0.6 = 60%)
DIRECT_EMAIL_MAX_PERCENTAGE=0.6

# Writing Pattern Analysis Configuration
# Number of emails to analyze for pattern extraction (default: 200)
PATTERN_ANALYSIS_CORPUS_SIZE=200
# Maximum tokens for pattern analysis LLM calls (default: 20000)
PATTERN_ANALYSIS_MAX_TOKENS=20000
# Number of example sentences to keep (default: 10)
PATTERN_EXAMPLE_COUNT=10
# Number of unique expressions to track (default: 15)
PATTERN_UNIQUE_EXPRESSIONS_COUNT=15

# LLM Configuration
# Number of retry attempts for LLM action analysis and response generation (default: 1)
LLM_ACTION_RETRIES=1

# Email Folder Configuration
# Default folder names for email organization
# Root folder for all email folders (leave empty for root level)
DEFAULT_ROOT_FOLDER=
# Folder for no-action emails (FYI only, large lists, unsubscribe)
DEFAULT_NO_ACTION_FOLDER=t2j-no-action
# Folder for spam emails
DEFAULT_SPAM_FOLDER=t2j-spam
# Folder for action items that need attention
DEFAULT_TODO_FOLDER=t2j-todo

# Background Job Scheduler Configuration
# Interval for checking new emails in milliseconds (default: 60000 = 1 minute)
CHECK_MAIL_INTERVAL=60000
# Interval for updating tone profiles in milliseconds (default: 86400000 = 24 hours)
UPDATE_TONE_INTERVAL=86400000

# Worker configuration (optional)
WORKERS_START_PAUSED=false  # Set to false to start workers automatically (true for manual control)
NEXT_PUBLIC_INBOX_BATCH_SIZE=3  # Number of emails to process in each batch (used by both server and client)
NEXT_PUBLIC_LOOK_BACK_DEFAULT_MINUTES=15  # Default time window for look back processing in minutes (used by both server and client)

# Email Processing Lock Configuration (distributed locking to prevent duplicate drafts)
EMAIL_PROCESSING_LOCK_TTL=30000  # Lock timeout in milliseconds (default: 30000 = 30 seconds)
EMAIL_PROCESSING_LLM_TIMEOUT=40000  # LLM generation timeout in milliseconds (default: 40000 = 40 seconds)

# BullMQ Worker Configuration
# Inbox worker settings
BULLMQ_INBOX_CONCURRENCY=5  # Number of concurrent jobs (default: 5)
BULLMQ_INBOX_LOCK_DURATION=120000  # Max job duration in ms (default: 120000 = 2 minutes)
BULLMQ_INBOX_LOCK_RENEW_TIME=30000  # Lock renewal interval in ms (default: 30000 = 30 seconds)
BULLMQ_INBOX_STALLED_INTERVAL=30000  # Stalled job check interval in ms (default: 30000 = 30 seconds)
BULLMQ_INBOX_MAX_STALLED_COUNT=1  # Max stall count before job fails (default: 1)

# Training worker settings
BULLMQ_TRAINING_CONCURRENCY=2  # Number of concurrent jobs (default: 2)
BULLMQ_TRAINING_LOCK_DURATION=600000  # Max job duration in ms (default: 600000 = 10 minutes)
BULLMQ_TRAINING_LOCK_RENEW_TIME=60000  # Lock renewal interval in ms (default: 60000 = 1 minute)
BULLMQ_TRAINING_STALLED_INTERVAL=60000  # Stalled job check interval in ms (default: 60000 = 1 minute)
BULLMQ_TRAINING_MAX_STALLED_COUNT=1  # Max stall count before job fails (default: 1)

# BullMQ Redis connection settings
BULLMQ_REDIS_RETRY_DELAY_MIN=50  # Min retry delay in ms (default: 50)
BULLMQ_REDIS_RETRY_DELAY_MAX=2000  # Max retry delay in ms (default: 2000)

# BullMQ Runtime cleanup settings
BULLMQ_CLEANUP_INTERVAL=120000  # Periodic cleanup interval in ms (default: 120000 = 2 minutes)
BULLMQ_INBOX_CLEANUP_STALE_AGE=180000  # Age threshold for stale inbox jobs in ms (default: 180000 = 3 minutes, inbox lock + 1 min buffer)
BULLMQ_TRAINING_CLEANUP_STALE_AGE=660000  # Age threshold for stale training jobs in ms (default: 660000 = 11 minutes, training lock + 1 min buffer)